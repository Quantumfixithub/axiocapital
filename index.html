<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Axio Capital</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Montserrat',sans-serif;background:#f5f7fa;color:#333;padding-bottom:85px}
        .header{background:linear-gradient(135deg,#0A1628,#1a2942);padding:22px 20px 62px;border-radius:0 0 32px 32px}
        .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
        .logo{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;color:#D4AF37;letter-spacing:1px}
        .header-icons{display:flex;gap:10px;align-items:center}
        .icon-btn{background:rgba(255,255,255,.1);border:1px solid rgba(212,175,55,.3);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#D4AF37;font-size:19px;cursor:pointer;text-decoration:none;transition:all .3s}
        .icon-btn:hover{background:rgba(212,175,55,.2)}
        .logout-btn{background:rgba(231,76,60,.15);border:1px solid rgba(231,76,60,.35);color:#ff7875;padding:7px 14px;border-radius:20px;font-size:12px;font-weight:600;cursor:pointer;font-family:'Montserrat',sans-serif;transition:all .3s}
        .logout-btn:hover{background:rgba(231,76,60,.3)}
        .welcome{font-size:13px;color:rgba(255,255,255,.6);margin-bottom:4px}
        .user-name{font-size:22px;font-weight:700;color:#D4AF37;font-family:'Cormorant Garamond',serif}
        /* Balance card */
        .balance-card{background:linear-gradient(135deg,#D4AF37 0%,#F4E4A6 50%,#D4AF37 100%);border-radius:24px;padding:26px;margin:0 18px;margin-top:-42px;box-shadow:0 14px 36px rgba(212,175,55,.35);position:relative;overflow:hidden;z-index:10}
        .balance-card::before{content:'';position:absolute;top:-60%;right:-30%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.15) 0%,transparent 60%)}
        .balance-label{color:rgba(10,22,40,.7);font-size:13px;margin-bottom:6px}
        .balance-amount{font-size:40px;font-weight:700;color:#0A1628;font-family:'Cormorant Garamond',serif;margin-bottom:22px;position:relative}
        .balance-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;position:relative}
        .balance-btn{background:#0A1628;color:#D4AF37;padding:15px;border-radius:14px;text-align:center;font-weight:700;font-size:14px;transition:all .3s;border:none;cursor:pointer;font-family:'Montserrat',sans-serif;display:flex;align-items:center;justify-content:center;gap:8px;letter-spacing:.3px}
        .balance-btn:hover{transform:translateY(-2px);box-shadow:0 8px 22px rgba(10,22,40,.4);color:#F4E4A6}
        .balance-btn:active{transform:translateY(0)}
        /* Stats */
        .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:11px;padding:0 18px;margin:22px 0}
        .stat-card{background:#fff;border-radius:16px;padding:18px 10px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.05)}
        .stat-value{font-size:21px;font-weight:700;color:#0A1628;margin-bottom:4px;font-family:'Cormorant Garamond',serif}
        .stat-label{font-size:10px;color:#999;text-transform:uppercase;letter-spacing:.5px}
        /* Daily game banner */
        .game-banner{background:linear-gradient(135deg,#1a0a2e,#2d1b69);border-radius:20px;padding:20px;margin:0 18px 22px;position:relative;overflow:hidden;cursor:pointer;transition:all .3s;border:1px solid rgba(138,43,226,.3)}
        .game-banner:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(138,43,226,.3)}
        .game-banner::after{content:'üéÆ';position:absolute;right:18px;top:50%;transform:translateY(-50%);font-size:52px;opacity:.25}
        .game-title{font-size:18px;font-weight:700;color:#c084fc;margin-bottom:5px;font-family:'Cormorant Garamond',serif}
        .game-desc{font-size:12px;color:rgba(255,255,255,.7);margin-bottom:12px}
        .game-prize{display:inline-flex;align-items:center;gap:6px;background:rgba(192,132,252,.15);border:1px solid rgba(192,132,252,.3);color:#c084fc;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:700}
        .game-status{display:inline-flex;align-items:center;gap:6px;margin-left:8px;padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600}
        .game-status.available{background:rgba(76,217,100,.15);color:#4cd964;border:1px solid rgba(76,217,100,.3)}
        .game-status.played{background:rgba(150,150,150,.15);color:#aaa;border:1px solid rgba(150,150,150,.3)}
        /* Quick actions */
        .section{padding:0 18px;margin:24px 0}
        .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
        .section-title{font-size:18px;font-weight:600;color:#0A1628;font-family:'Cormorant Garamond',serif}
        .see-all{color:#D4AF37;text-decoration:none;font-size:13px;font-weight:500}
        .quick-actions{display:grid;grid-template-columns:repeat(4,1fr);gap:11px}
        .action-item{background:#fff;border-radius:16px;padding:18px 8px;text-align:center;text-decoration:none;color:#333;box-shadow:0 2px 10px rgba(0,0,0,.05);transition:all .3s;cursor:pointer;border:none;font-family:'Montserrat',sans-serif;width:100%}
        .action-item:hover{transform:translateY(-4px);box-shadow:0 8px 22px rgba(0,0,0,.1)}
        .action-icon{font-size:28px;margin-bottom:7px}
        .action-label{font-size:11px;font-weight:600;color:#555}
        /* VIP banner */
        .vip-banner{background:linear-gradient(135deg,#0A1628,#1a2942);border-radius:20px;padding:22px;color:#fff;margin:0 18px 24px;position:relative;overflow:hidden}
        .vip-banner::after{content:'üëë';position:absolute;right:16px;top:50%;transform:translateY(-50%);font-size:52px;opacity:.18}
        .vip-title{font-size:19px;font-weight:700;color:#D4AF37;margin-bottom:5px;font-family:'Cormorant Garamond',serif}
        .vip-desc{font-size:12px;color:rgba(255,255,255,.7);margin-bottom:13px}
        .vip-btn{background:#D4AF37;color:#0A1628;padding:11px 22px;border-radius:10px;display:inline-block;text-decoration:none;font-weight:700;font-size:13px;transition:all .3s}
        .vip-btn:hover{transform:translateY(-2px);box-shadow:0 5px 16px rgba(212,175,55,.4)}
        /* Activity */
        .activity-card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
        .activity-item{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #f3f3f3}
        .activity-item:last-child{border-bottom:none}
        .act-title{font-weight:600;color:#0A1628;font-size:13px;margin-bottom:3px}
        .act-date{font-size:11px;color:#bbb}
        .act-amount{font-weight:700;font-size:14px}
        .act-amount.pos{color:#4cd964}
        .act-amount.neg{color:#ff6b6b}
        .empty-act{text-align:center;padding:30px 10px;color:#ccc;font-size:14px}
        /* Bottom nav */
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:#fff;display:flex;justify-content:space-around;padding:11px 0 8px;box-shadow:0 -2px 14px rgba(0,0,0,.09);z-index:1000}
        .nav-item{display:flex;flex-direction:column;align-items:center;text-decoration:none;color:#ccc;flex:1;transition:all .2s}
        .nav-item.active,.nav-item:hover{color:#D4AF37}
        .nav-icon{font-size:23px;margin-bottom:3px}
        .nav-label{font-size:10px;font-weight:600}
        /* Chatbot FAB */
        .chat-fab{position:fixed;bottom:80px;right:20px;width:54px;height:54px;background:linear-gradient(135deg,#0088cc,#006699);border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 22px rgba(0,136,204,.45);cursor:pointer;z-index:999;text-decoration:none;transition:all .3s;border:none}
        .chat-fab:hover{transform:scale(1.1);box-shadow:0 10px 30px rgba(0,136,204,.55)}
        .chat-fab svg{width:26px;height:26px;fill:#fff}
        .chat-pulse{position:absolute;top:-2px;right:-2px;width:16px;height:16px;background:#4cd964;border-radius:50%;border:2px solid #fff;animation:pulse 2s infinite}
        @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.7}}
        /* Game Modal */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:2000;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(4px)}
        .modal-overlay.open{display:flex}
        .game-modal{background:linear-gradient(135deg,#1a0a2e,#2d1b69);border-radius:24px;padding:32px 24px;width:100%;max-width:380px;text-align:center;border:1px solid rgba(192,132,252,.3);box-shadow:0 20px 60px rgba(138,43,226,.4)}
        .game-modal h2{font-family:'Cormorant Garamond',serif;font-size:28px;color:#c084fc;margin-bottom:8px}
        .game-modal p{font-size:14px;color:rgba(255,255,255,.7);margin-bottom:24px;line-height:1.6}
        /* Number guessing game */
        .game-area{margin-bottom:20px}
        .game-question{font-size:16px;color:#fff;font-weight:600;margin-bottom:16px}
        .game-options{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
        .game-opt{padding:14px;background:rgba(192,132,252,.12);border:1.5px solid rgba(192,132,252,.3);border-radius:12px;color:#c084fc;font-size:18px;font-weight:700;cursor:pointer;transition:all .2s;font-family:'Cormorant Garamond',serif}
        .game-opt:hover{background:rgba(192,132,252,.25);transform:scale(1.05)}
        .game-opt.correct{background:rgba(76,217,100,.2);border-color:#4cd964;color:#4cd964}
        .game-opt.wrong{background:rgba(231,76,60,.15);border-color:#e74c3c;color:#e74c3c}
        .game-result{font-size:15px;font-weight:700;padding:14px;border-radius:12px;margin-bottom:16px;display:none}
        .game-result.win{background:rgba(76,217,100,.15);border:1px solid rgba(76,217,100,.3);color:#4cd964}
        .game-result.lose{background:rgba(231,76,60,.12);border:1px solid rgba(231,76,60,.3);color:#ff7875}
        .modal-close{width:100%;padding:14px;background:rgba(192,132,252,.15);border:1px solid rgba(192,132,252,.3);color:#c084fc;border-radius:12px;font-size:14px;font-weight:600;cursor:pointer;font-family:'Montserrat',sans-serif;transition:all .2s}
        .modal-close:hover{background:rgba(192,132,252,.25)}
        .prize-display{font-size:36px;font-weight:700;color:#4cd964;font-family:'Cormorant Garamond',serif;margin:10px 0}
        .countdown-text{font-size:12px;color:rgba(255,255,255,.5);margin-top:8px}
    </style>
</head>
<body>

<!-- ===== AUTH GUARD ===== -->
<script>
(function(){
    if(!localStorage.getItem('authToken')){
        sessionStorage.setItem('axio_redirect','index.html');
        window.location.replace('login.html');
    }
})();
</script>

<!-- ===== HEADER ===== -->
<div class="header">
    <div class="header-top">
        <div class="logo">Axio Capital</div>
        <div class="header-icons">
            <a href="settings.html" class="icon-btn">‚öôÔ∏è</a>
            <button class="logout-btn" onclick="doLogout()">Logout</button>
        </div>
    </div>
    <div class="welcome">Welcome back,</div>
    <div class="user-name" id="userName">Member</div>
</div>

<!-- ===== BALANCE CARD ===== -->
<div class="balance-card">
    <div class="balance-label">Total Balance</div>
    <div class="balance-amount" id="totalBalance">‚Ç¶0.00</div>
    <div class="balance-actions">
        <button class="balance-btn" onclick="goDeposit()">üí≥ Deposit</button>
        <button class="balance-btn" onclick="goWithdraw()">üí∏ Withdraw</button>
    </div>
</div>

<!-- ===== STATS ===== -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value" id="todayEarn">‚Ç¶0</div>
        <div class="stat-label">Today's Profit</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="totalProfit">‚Ç¶0</div>
        <div class="stat-label">Total Profit</div>
    </div>
    <div class="stat-card">
        <div class="stat-value" id="teamCount">0</div>
        <div class="stat-label">Team Size</div>
    </div>
</div>

<!-- ===== DAILY GAME BANNER ===== -->
<div class="game-banner" onclick="openGame()" id="gameBanner">
    <div class="game-title">üéÆ Daily Lucky Number</div>
    <div class="game-desc">Pick the correct number and earn ‚Ç¶10 ‚Äî once every 24 hours!</div>
    <span class="game-prize">üéÅ Prize: ‚Ç¶10</span>
    <span class="game-status available" id="gameStatusBadge">‚úì Available Now</span>
</div>

<!-- ===== QUICK ACTIONS ===== -->
<div class="section">
    <div class="section-header">
        <h3 class="section-title">Quick Actions</h3>
    </div>
    <div class="quick-actions">
        <a href="vip.html" class="action-item"><div class="action-icon">üëë</div><div class="action-label">VIP</div></a>
        <a href="finance.html" class="action-item"><div class="action-icon">üìä</div><div class="action-label">Finance</div></a>
        <a href="team.html" class="action-item"><div class="action-icon">üë•</div><div class="action-label">Team</div></a>
        <a href="invitation.html" class="action-item"><div class="action-icon">üéÅ</div><div class="action-label">Invite</div></a>
        <a href="records.html" class="action-item"><div class="action-icon">üìù</div><div class="action-label">Records</div></a>
        <a href="wallet.html" class="action-item"><div class="action-icon">üíº</div><div class="action-label">Wallet</div></a>
        <a href="checkin.html" class="action-item"><div class="action-icon">‚úÖ</div><div class="action-label">Check-in</div></a>
        <a href="spin.html" class="action-item"><div class="action-icon">üé∞</div><div class="action-label">Spin</div></a>
    </div>
</div>

<!-- ===== VIP BANNER ===== -->
<div class="vip-banner">
    <div class="vip-title">Upgrade to VIP</div>
    <div class="vip-desc">Unlock higher daily returns and exclusive benefits</div>
    <a href="vip.html" class="vip-btn">View VIP Levels ‚Üí</a>
</div>

<!-- ===== RECENT ACTIVITY ===== -->
<div class="section">
    <div class="section-header">
        <h3 class="section-title">Recent Activity</h3>
        <a href="records.html" class="see-all">See All ‚Üí</a>
    </div>
    <div class="activity-card" id="activityCard">
        <div class="empty-act">üìÑ No activity yet.<br><span style="font-size:12px;color:#ddd">Make your first deposit to get started!</span></div>
    </div>
</div>

<!-- ===== BOTTOM NAV ===== -->
<div class="bottom-nav">
    <a href="index.html" class="nav-item active"><div class="nav-icon">üè†</div><div class="nav-label">Home</div></a>
    <a href="vip.html" class="nav-item"><div class="nav-icon">üëë</div><div class="nav-label">VIP</div></a>
    <a href="team.html" class="nav-item"><div class="nav-icon">üë•</div><div class="nav-label">Team</div></a>
    <a href="mine.html" class="nav-item"><div class="nav-icon">üë§</div><div class="nav-label">Mine</div></a>
</div>

<!-- ===== TELEGRAM CHATBOT FAB ===== -->
<a class="chat-fab" href="https://t.me/AxioCapitalSupport" target="_blank" title="Chat Support on Telegram">
    <div class="chat-pulse"></div>
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.447 1.394c-.16.16-.295.295-.605.295l.213-3.053 5.56-5.023c.242-.213-.054-.333-.373-.12l-6.871 4.326-2.962-.924c-.643-.204-.657-.643.136-.953l11.57-4.461c.537-.194 1.006.131.833.941z"/>
    </svg>
</a>

<!-- ===== DAILY GAME MODAL ===== -->
<div class="modal-overlay" id="gameModal">
    <div class="game-modal">
        <div id="gameContent"></div>
    </div>
</div>

<script>
// ===== LOGOUT =====
function doLogout(){
    if(!confirm('Are you sure you want to log out?')) return;
    ['authToken','userId','userName','userEmail','userPassword','kycStatus'].forEach(k=>localStorage.removeItem(k));
    window.location.replace('login.html');
}

// ===== DEPOSIT / WITHDRAW BUTTONS =====
function goDeposit(){
    const kyc = localStorage.getItem('kycStatus')||'none';
    if(kyc === 'approved'){
        window.location.href = 'recharge.html';
    } else if(kyc === 'pending'){
        alert('‚è≥ KYC Under Review\n\nYour identity verification is being reviewed by our team. You will be able to deposit once it is approved (within 1‚Äì24 hours).');
    } else {
        if(confirm('‚ö†Ô∏è KYC Required Before Deposit\n\nYou must complete identity verification (KYC) before making a deposit. This ensures your account security.\n\nTap OK to go to KYC verification now.')){
            window.location.href = 'kyc.html';
        }
    }
}

function goWithdraw(){
    const bal = parseFloat(localStorage.getItem('userBalance')||'0');
    if(bal < 3500){
        alert('‚ö†Ô∏è Insufficient Balance\n\nMinimum withdrawal is ‚Ç¶3,500.\nYour current balance: ‚Ç¶' + bal.toLocaleString('en-NG',{minimumFractionDigits:2}) + '\n\nContinue investing to grow your balance!');
        return;
    }
    window.location.href = 'withdraw.html';
}

// ===== LOAD DASHBOARD =====
(function initDashboard(){
    const uid = localStorage.getItem('userId')||'';
    const name = localStorage.getItem('userName')||'Member';
    document.getElementById('userName').textContent = name;

    // Balance
    const bal = parseFloat(localStorage.getItem('userBalance')||'0');
    document.getElementById('totalBalance').textContent = '‚Ç¶' + bal.toLocaleString('en-NG',{minimumFractionDigits:2});

    // Today earnings from checkin
    const checkins = JSON.parse(localStorage.getItem('checkinHistory_'+uid)||'[]');
    const todayStr = new Date().toDateString();
    const todayEarn = checkins.filter(c=>new Date(c.date).toDateString()===todayStr).reduce((s,c)=>s+(c.amount||0),0);

    // Game earnings today
    const gameWins = JSON.parse(localStorage.getItem('gameWins_'+uid)||'[]');
    const todayGame = gameWins.filter(g=>new Date(g.date).toDateString()===todayStr).reduce((s,g)=>s+(g.amount||0),0);

    document.getElementById('todayEarn').textContent = '‚Ç¶'+(todayEarn+todayGame).toLocaleString('en-NG');

    // Total profit from approved deposits
    const deposits = JSON.parse(localStorage.getItem('pendingDeposits')||'[]');
    const myApproved = deposits.filter(d=>d.userId===uid&&d.status==='approved');
    const totalP = myApproved.reduce((s,d)=>s+d.amount,0);
    document.getElementById('totalProfit').textContent = '‚Ç¶'+totalP.toLocaleString('en-NG');

    // Team size
    const users = JSON.parse(localStorage.getItem('registeredUsers')||'[]');
    const team = users.filter(u=>u.referredBy===uid);
    document.getElementById('teamCount').textContent = team.length;

    // Recent activity
    const allActs = [
        ...myApproved.map(d=>({title:'Deposit Approved',amount:d.amount,sign:'pos',date:d.date})),
        ...JSON.parse(localStorage.getItem('pendingWithdrawals')||'[]').filter(w=>w.userId===uid&&w.status==='approved').map(w=>({title:'Withdrawal Processed',amount:w.amount,sign:'neg',date:w.date})),
        ...checkins.map(c=>({title:'Daily Check-in Bonus',amount:c.amount,sign:'pos',date:c.date})),
        ...gameWins.map(g=>({title:'Daily Game Win üéÆ',amount:g.amount,sign:'pos',date:g.date})),
        ...JSON.parse(localStorage.getItem('spinWins_'+uid)||'[]').map(s=>({title:'Lucky Spin Win üé∞',amount:s.prize,sign:'pos',date:new Date().toISOString()})),
    ].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,7);

    const ac = document.getElementById('activityCard');
    if(allActs.length){
        ac.innerHTML = allActs.map(a=>`
        <div class="activity-item">
            <div>
                <div class="act-title">${a.title}</div>
                <div class="act-date">${new Date(a.date).toLocaleString('en-NG',{dateStyle:'medium',timeStyle:'short'})}</div>
            </div>
            <div class="act-amount ${a.sign}">${a.sign==='pos'?'+':'-'}‚Ç¶${Number(a.amount).toLocaleString('en-NG',{minimumFractionDigits:2})}</div>
        </div>`).join('');
    }

    // Game status badge
    updateGameBadge();
})();

// ===== DAILY GAME =====
function gamePlayedToday(){
    const uid = localStorage.getItem('userId')||'';
    const last = localStorage.getItem('lastGamePlay_'+uid);
    if(!last) return false;
    return new Date(last).toDateString() === new Date().toDateString();
}

function updateGameBadge(){
    const badge = document.getElementById('gameStatusBadge');
    if(gamePlayedToday()){
        badge.className = 'game-status played';
        badge.textContent = '‚úì Played Today';
    } else {
        badge.className = 'game-status available';
        badge.textContent = '‚úì Available Now';
    }
}

function openGame(){
    if(gamePlayedToday()){
        // Show countdown to next game
        const uid = localStorage.getItem('userId')||'';
        const last = new Date(localStorage.getItem('lastGamePlay_'+uid));
        const next = new Date(last.getTime() + 24*3600*1000);
        const diff = next - new Date();
        const hrs = Math.floor(diff/3600000);
        const mins = Math.floor((diff%3600000)/60000);
        document.getElementById('gameContent').innerHTML = `
            <div style="font-size:64px;margin-bottom:16px">‚è≥</div>
            <h2>Already Played!</h2>
            <p>You've already played today's game. Come back in:</p>
            <div style="font-size:32px;font-weight:700;color:#c084fc;font-family:'Cormorant Garamond',serif;margin:16px 0">${hrs}h ${mins}m</div>
            <p style="font-size:12px;color:rgba(255,255,255,.4)">New game resets every 24 hours</p>
            <button class="modal-close" style="margin-top:20px" onclick="closeGame()">Close</button>`;
        document.getElementById('gameModal').classList.add('open');
        return;
    }

    // Generate game: pick a number 1-9, user guesses
    const answer = Math.floor(Math.random()*9)+1;
    const nums = Array.from({length:9},(_,i)=>i+1);
    // Shuffle display order
    for(let i=nums.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[nums[i],nums[j]]=[nums[j],nums[i]];}

    document.getElementById('gameContent').innerHTML = `
        <div style="font-size:48px;margin-bottom:10px">üéØ</div>
        <h2>Daily Lucky Number</h2>
        <p>I'm thinking of a number between 1 and 9. Can you guess it? Pick right and win <strong style="color:#4cd964">‚Ç¶10</strong>!</p>
        <div class="game-area">
            <div class="game-question">Pick a number:</div>
            <div class="game-options" id="gameOptions">
                ${nums.map(n=>`<button class="game-opt" onclick="checkAnswer(${n},${answer},this)">${n}</button>`).join('')}
            </div>
            <div class="game-result" id="gameResult"></div>
        </div>
        <button class="modal-close" onclick="closeGame()">Cancel</button>`;
    document.getElementById('gameModal').classList.add('open');
}

function checkAnswer(chosen, answer, btn){
    const uid = localStorage.getItem('userId')||'';
    const opts = document.querySelectorAll('.game-opt');
    const result = document.getElementById('gameResult');

    // Disable all options
    opts.forEach(o=>o.disabled=true);

    // Mark correct answer green
    opts.forEach(o=>{
        if(parseInt(o.textContent)===answer) o.classList.add('correct');
    });

    const isWin = chosen === answer;
    if(isWin) btn.classList.add('correct');
    else { btn.classList.add('wrong'); }

    if(isWin){
        result.className='game-result win';
        result.style.display='block';
        result.innerHTML = `üéâ Correct! You guessed right!<div class="prize-display">+‚Ç¶10</div>`;
        // Credit ‚Ç¶10
        let bal = parseFloat(localStorage.getItem('userBalance')||'0');
        bal += 10;
        localStorage.setItem('userBalance', bal.toString());
        // Record win
        const wins = JSON.parse(localStorage.getItem('gameWins_'+uid)||'[]');
        wins.unshift({amount:10,date:new Date().toISOString()});
        localStorage.setItem('gameWins_'+uid,JSON.stringify(wins));
    } else {
        result.className='game-result lose';
        result.style.display='block';
        result.innerHTML = `‚ùå Wrong! The number was <strong>${answer}</strong>.<br><span style="font-size:13px;opacity:.8">Better luck tomorrow!</span>`;
    }

    // Mark as played
    localStorage.setItem('lastGamePlay_'+uid, new Date().toISOString());
    updateGameBadge();

    // Add close button
    document.querySelector('.modal-close').textContent = isWin ? 'üéâ Claim & Close' : 'Close';
    document.querySelector('.modal-close').onclick = ()=>{closeGame(); if(isWin) location.reload();};
}

function closeGame(){
    document.getElementById('gameModal').classList.remove('open');
}
</script>
</body>
</html>
